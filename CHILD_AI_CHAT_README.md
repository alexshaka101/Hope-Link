# 🧒 HopeLink 孩童端 AI 聊天功能說明

## 📋 功能概述

此系統利用 Google Gemini API 打造了一個專為失散兒童設計的安全、溫和的 AI 對話介面，能夠引導孩童自然地分享關於家的記憶。

---

## 🎯 核心功能模組

### 1️⃣ 🎧 Voice2Text 模組
- **功能**：將孩童的語音即時轉為文字
- **實現**：使用 Web Speech Recognition API
- **支援語言**：中文、英文、烏克蘭文、阿拉伯文
- **情緒分析**：記錄語音置信度作為情緒參考

### 2️⃣ 🗣️ Prompt Engine（提問引擎）
- **功能**：根據對話階段生成適當的提問
- **階段設計**：
  - **階段 1**（訊息 1-5）：中性話題（食物、顏色、玩具）
  - **階段 2**（訊息 6-10）：家庭相關（房子、寵物、家人特徵）
  - **階段 3**（訊息 11+）：情感深入（記憶、思念）
- **AI 引擎**：使用 Gemini Pro 生成自然、溫和的提問

### 3️⃣ 🧩 Semantic Extractor（語義提取）
- **功能**：使用 NLP 技術提取關鍵信息
- **提取內容**：
  - 主題分類（家庭/食物/地點/人物/情感/其他）
  - 關鍵名詞
  - 情感傾向（正面/中性/負面）
  - 家庭相關性判定
  - 置信度評分
- **視覺化**：自動生成關鍵詞標籤與主題圖標

### 4️⃣ 🔒 Hash Encoder（哈希編碼）
- **功能**：對提取的語義內容進行 SHA-256 加密
- **保護機制**：
  - 不儲存原始對話內容
  - 僅保留語義摘要的加密哈希
  - 確保隱私與安全性
- **輸出**：生成語義摘要卡（Semantic Memory Card）

### 5️⃣ 🧾 Memory Pool（記憶池）
- **功能**：儲存語義摘要卡供後端比對
- **儲存內容**：
  - Session ID
  - 時間戳記
  - 語言設定
  - 對話階段
  - 提取的關鍵詞
  - 語義哈希值
- **當前實現**：使用 localStorage（實際應用應傳送至後端）

### 6️⃣ 🕊️ Safety Monitor（安全監測）
- **功能**：即時監測負面情緒與創傷關鍵字
- **觸發條件**：
  - 偵測到敏感詞彙（fear, war, hit, hurt, scared, 害怕, 戰爭, 打, 痛, 等）
  - 孩童選擇「難過」或「緊張」表情連續多次
  - 語音置信度異常降低
- **安全措施**：
  - 自動暫停對話
  - 切換至安撫模式（月亮與星星動畫）
  - 提供溫和的安慰訊息

---

## 🎨 UI/UX 設計特色

### 視覺元素
- **AI 角色光球**：
  - 橘黃漸層核心，綠色光環
  - 柔和的脈動與漂浮動畫
  - 傳達溫暖與安全感

- **對話氣泡**：
  - AI（光光）：橘黃漸層背景
  - 孩童：綠色漸層背景
  - 平滑的淡入彈出動畫

- **回憶樹視覺化**：
  - SVG 動態繪製樹幹
  - 隨對話增加的發光光點
  - 代表記憶被妥善保存

- **情緒狀態指示**：
  - 💚 正常對話
  - 🌧️ 偵測到緊張
  - 🌙 休息模式

### 互動元素
- **🎙️ 語音輸入按鈕**：
  - 按住說話模式
  - 錄音時脈動波紋動畫
  - 大而明顯，適合兒童操作

- **😊 表情選擇器**：
  - 5 種表情（開心、緊張、難過、想休息、還好）
  - 即時反映孩童情緒狀態
  - 影響 AI 的回應語氣

- **🌿 故事回顧區**：
  - 顯示提取的關鍵詞
  - 按主題分類（家庭🏠、食物🍎、情感💚、地點📍）
  - 點擊可發光效果

### 安撫模式
- **視覺效果**：
  - 深藍漸層背景
  - 發光的月亮圖標
  - 閃爍的星星
- **文字訊息**：
  - 「沒關係，我們休息一下 💚」
  - 「你做得很好了」
- **互動**：
  - 「準備好繼續了」按鈕
  - 柔和的恢復動畫

---

## 🛠️ 技術實現

### API 整合
```javascript
// Gemini API 設定
const GEMINI_API_KEY = 'AIzaSyDEXYSZI5GNe266b6P5F4DLY7G6JdbtI4c';
const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';
```

### 安全配置
- **Content Safety**：啟用 Gemini API 的內容安全過濾
- **Harm Categories**：阻擋中等及以上的有害內容
- **Temperature**：設為 0.7，平衡創意與一致性
- **Max Tokens**：限制為 256，確保回應簡短

### 多語言支援
- 中文（繁體）`zh`
- English `en`
- Українська `uk`
- العربية `ar`

---

## 📱 使用流程

### 開啟聊天
1. 點擊「孩童端」入口
2. 閱讀使用說明
3. 點擊「開始使用」
4. 選擇語言（右上角）

### 進行對話
1. **按住** 🎙️ 麥克風按鈕說話
2. **鬆開** 停止錄音
3. 系統自動轉換為文字並分析
4. 光光會溫柔地回應並提問

### 表達情緒
- 點擊表情按鈕表達當下感受
- 選擇「😴 想休息」進入安撫模式
- 系統會根據情緒調整對話

### 查看故事
- 點擊「🌿 查看我的故事」
- 查看已提取的關鍵詞
- 看到記憶樹上的發光點

### 暫停與結束
- 點擊「🌙 休息一下」暫停
- 準備好後點擊「準備好繼續了」
- 關閉視窗自動儲存記憶卡

---

## 🔐 隱私與安全

### 資料保護
- ✅ 所有語音即時處理，不儲存原始音訊
- ✅ 對話內容經語義提取後僅保留關鍵詞
- ✅ 語義摘要進行 SHA-256 加密
- ✅ 生成的哈希值無法反推原始內容

### 安全機制
- ✅ 自動偵測負面情緒與創傷關鍵字
- ✅ 異常情況自動暫停對話
- ✅ 提供安撫模式降低心理壓力
- ✅ 符合 GDPR 與 UNICEF 隱私準則

### 儲存位置
- **當前版本**：localStorage（本地儲存）
- **生產環境建議**：
  - 使用加密的後端 API
  - 資料傳輸使用 HTTPS
  - 後端資料庫加密儲存
  - 定期清理過期資料

---

## 🚀 部署注意事項

### API Key 安全
⚠️ **重要**：當前 API Key 是硬編碼在前端，僅供開發測試使用！

**生產環境必須**：
1. 移除前端的 API Key
2. 設置後端代理伺服器
3. 在後端處理 Gemini API 請求
4. 使用環境變數管理 API Key

### 瀏覽器支援
- **語音識別**：需要 Chrome、Edge 或 Safari
- **其他功能**：支援所有現代瀏覽器
- **建議**：提供文字輸入作為備用方案

### 效能優化
- 限制對話歷史記錄數量（當前無限制）
- 實現對話內容壓縮
- 優化 API 請求頻率
- 加入載入狀態指示

---

## 🎯 後續開發建議

### 短期優化
1. **文字輸入備用方案**：
   - 為不支援語音的瀏覽器提供文字輸入
   - 鍵盤輸入模式切換

2. **情緒分析增強**：
   - 整合語音音調分析
   - 分析語速與停頓
   - 更精準的情緒偵測

3. **多模態輸入**：
   - 允許孩童繪圖
   - 上傳照片（自動模糊處理）
   - 選擇圖示表達想法

### 長期規劃
1. **AI 模型微調**：
   - 使用兒童對話資料集微調
   - 訓練專門的情感分析模型
   - 提升對不同年齡層的適應性

2. **語義比對系統**：
   - 開發家長端比對介面
   - 實現模糊匹配演算法
   - NGO 人工審核流程整合

3. **進階安全功能**：
   - 即時心理狀態評估
   - 異常行為模式偵測
   - 專業心理諮詢師介入機制

4. **國際化擴展**：
   - 增加更多語言支援
   - 本地化 UI/UX
   - 文化適應性調整

---

## 📞 技術支援

### 常見問題

**Q: 語音識別無法使用？**
A: 請確認：
- 使用支援的瀏覽器（Chrome/Edge/Safari）
- 已授予麥克風權限
- 使用 HTTPS 連線（本地測試可用 localhost）

**Q: AI 沒有回應？**
A: 可能原因：
- API 配額已用盡
- 網路連線問題
- API Key 無效
- 檢查瀏覽器 Console 錯誤訊息

**Q: 記憶卡在哪裡？**
A: 
- 開發版：瀏覽器 localStorage（`hopelink-memory-cards`）
- 可用瀏覽器開發工具查看
- 生產版應傳送至後端伺服器

**Q: 如何重置對話？**
A:
- 重新整理頁面
- 或在 Console 執行：`localStorage.removeItem('hopelink-memory-cards')`

---

## 👨‍💻 開發團隊

**HopeLink © 2025 Humanitarian Tech Initiative**

本專案致力於利用 AI 技術協助失散兒童與家人重聚。

---

## 📄 授權

本專案僅用於人道救援目的。
所有資料處理符合 GDPR 與 UNICEF 隱私準則。

**重要聲明**：
- 禁止將本系統用於商業用途
- 禁止未經授權的資料收集
- 必須遵守當地兒童保護法規
- 需要專業 NGO 組織監督使用

---

## 🔗 相關資源

- [Gemini API 文檔](https://ai.google.dev/docs)
- [Web Speech API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API)
- [UNICEF 兒童隱私準則](https://www.unicef.org/privacy-policy)
- [GDPR 合規指南](https://gdpr.eu/)

---

**最後更新**：2025年10月20日
**版本**：1.0.0

